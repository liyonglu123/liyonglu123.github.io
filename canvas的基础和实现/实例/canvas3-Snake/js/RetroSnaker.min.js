var Game=(()=>{"use strict";function m(){a.clearRect(0,0,g,h),a.fillStyle="white",a.font=2*h/15+"px Lucida Console",a.fillText("You are Dead!",g/6,h/2,2*g/3),a.font=1*h/25+"px Lucida Console",a.fillStyle="#ccc",a.fillText("History High Score:"+j,6.5*g/20,5*h/8,2*g/5),a.fillText('Press "Enter" to Restart',3*g/10,11*h/15,2*g/5)}function n(b){b.preventDefault();var c=b.keyCode||b.which,d=p(l.difficulty),j=37==c||38==c||39==c||40==c;j&&(f&&(clearTimeout(e),clearTimeout(f)),x.publish("Dir-change",c),2==Math.abs(i-c)&&(c=i),f=setTimeout(function b(){var f=y.pos,i=z.pos;e=setTimeout(b,d),a.clearRect(0,0,g,h),x.publish("Game-rendering",{f:f,s:i,code:c})},50))}function o(b,c,d,e){a.beginPath(),a.arc(b+.5*d,c+.5*d,.5*d,0,2*Math.PI),a.fillStyle=e,a.fill()}function p(a){switch(a){case"easy":return 150;case"hard":return 70;case"hell":return 50;default:case"normal":return 100}}function q(e,f,i,j,k,m){var o=document.getElementById(e);l.difficulty=j||l.difficulty,g=f||500,h=i||500,a=o.getContext("2d"),d=Math.floor(h/20),b=Math.floor(g/d),c=Math.floor(h/d),o.width=b*d,o.height=c*d,z.color=k||l.snakeColor,y.color=m||l.foodColor,y.score=0,document.removeEventListener("keyup",u),document.addEventListener("keyup",n),x.publish("Game-init",{d:d,ctx:a,xCount:b,yCount:c})}function r(){k=!1,document.removeEventListener("keyup",n),clearTimeout(e),clearTimeout(f),a.clearRect(0,0,g,h),x.publish("Game-over"),document.addEventListener("keyup",u)}function s(a){if("number"==typeof a[0]){var b=a[0]*d,c=a[1]*d;o(b,c,d,y.color)}else"object"==typeof a[0]?a.forEach((a=>{var b=a[0]*d,c=a[1]*d;o(b,c,d,z.color)})):console.error("You enter a wrong arr!")}function t(a){var b=Math.floor(Math.random()*a);return b}function u(a){13==a.keyCode&&(q("canvas",g,h,l.difficulty,l.snakeColor,l.foodColor),x.publish("Game-init"))}function v(){var b="Score:"+y.score;a.fillStyle="#ccc",a.font="20px Lucida Console",a.fillText(b,d,d)}function w(){a.clearRect(0,0,g,h),a.fillStyle="white",a.font=2*h/15+"px Lucida Console",a.fillText("Retro Snaker",g/6,h/2,2*g/3),a.font=1*h/25+"px Lucida Console",a.fillText('Press "↑ ↓ ← →" to Start',3*g/10,11*h/15,2*g/5)}var a,b,c,d,e,f,g,h,i,j=window.localStorage.highScore||0,k=!0,l={snakeColor:"red",foodColor:"blue",difficulty:"easy"},x=function(){var a={},b=a.hasOwnProperty;return{subscrible:(c,d)=>{b.call(a,c)||(a[c]=[]);a[c].push(d)-1;return{remove:function(b){delete a[c][b]}}},publish:(c,d)=>{b.call(a,c)&&a[c].forEach(function(a){a(void 0!=d?d:{})})}}}(),y={pos:[],score:0,init:function(){var a=this.pos;a[0]=t(b),a[1]=t(c),this.initCheck(a,z.pos),console.log("Init Food Successed!")},initCheck:function(a,b){if(void 0!=b)for(let c of b)a[0]==c[0]&&a[1]==c[1]&&(console.info("Prevent success!"),this.init())},collideCheck:function(a,b){var c=b[b.length-1];c[0]==a[0]&&c[1]==a[1]&&(this.score+=1,x.publish("Get-score",this.score),j=j>this.score?j:this.score,window.localStorage.highScore=j,y.init(),b.unshift(a))}},z={pos:[],initLength:4,init:function(){var a=[],d=this.initLength;a[0]=[],a[0][0]=t(b-1.2*d),a[0][1]=t(c-1.2*d);for(var e=a.length;e<d;e++)a[e]=[],a[e][0]=a[e-1][0]+1,a[e][1]=a[e-1][1];i=39,this.pos=a,console.log("Init Snake success!")},move:function(a){var d,e,b=this.pos,c=b[b.length-1];switch(a){case 37:d=c[0]-1,b.push([d,c[1]]);break;case 38:e=c[1]-1,b.push([c[0],e]);break;case 39:d=c[0]+1,b.push([d,c[1]]);break;case 40:e=c[1]+1,b.push([c[0],e])}return i=a,b.shift(),b},collideCheck:function(a,d){var e=a[0]<0||a[0]>=b||a[1]<0||a[1]>=c;if(e)return void r();for(let f of d)if(d.indexOf(f)!=d.length-1&&f[0]==a[0]&&f[1]==a[1])return void r()}};return x.subscrible("Game-rendering",function(a){var b=a.f,c=a.s,d=a.code;s(b),s(z.move(d)),y.collideCheck(b,c),z.collideCheck(c[c.length-1],c),v()}),x.subscrible("Game-init",function(){k&&w(),z.init(),y.init()}),x.subscrible("Game-over",m),{init:q,addons:x.subscrible}})();